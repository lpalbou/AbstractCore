<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Server Guide - AbstractCore</title>
    <meta name="description" content="Transform AbstractCore into an OpenAI-compatible API server. One server, all models, any client.">
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

    <!-- Navbar Component -->
    <script src="../assets/js/navbar-component.js"></script>
</head>
<body>
    <!-- Navigation -->
    <div class="navbar-placeholder"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            createNavbar({
                basePath: '',
                menuItems: [
                    { text: 'Features', href: '/docs/capabilities.html' },
                    { text: 'Quick Start', href: '/docs/getting-started.html' },
                    { text: 'Documentation', href: '/#docs' },
                    { text: 'Examples', href: '/docs/examples.html' },
                    {
                        text: 'GitHub',
                        href: 'https://github.com/lpalbou/abstractcore',
                        target: '_blank',
                        icon: 'github'
                    },
                    {
                        text: 'PyPI',
                        href: 'https://pypi.org/project/abstractcore/',
                        target: '_blank',
                        icon: 'pypi'
                    }
                ]
            });
        });
    </script>

    <!-- Main Content -->
    <main style="padding-top: 5rem;">
        <div class="container" style="max-width: 1300px;">
            <div class="doc-header" style="margin-bottom: 3rem;">
                <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">HTTP Server Guide</h1>
                <p style="font-size: 1.25rem; color: var(--text-secondary);">
                    Run AbstractCore as an OpenAI-compatible API gateway: one server, any provider, any model, any client.
                </p>
            </div>

            <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 2rem; border-radius: 0.75rem; color: white; margin-bottom: 3rem;">
                <h2 style="margin: 0 0 1rem 0;">Why use the server?</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.25rem;">
                    <div style="background: rgba(255, 255, 255, 0.12); padding: 1.25rem; border-radius: 0.75rem;">
                        <h3 style="margin: 0 0 0.5rem 0;">OpenAI-compatible</h3>
                        <p style="margin: 0; opacity: 0.95;">Use standard clients, route via <code>model="provider/model"</code>.</p>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.12); padding: 1.25rem; border-radius: 0.75rem;">
                        <h3 style="margin: 0 0 0.5rem 0;">One endpoint</h3>
                        <p style="margin: 0; opacity: 0.95;">Switch providers without changing your application code.</p>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.12); padding: 1.25rem; border-radius: 0.75rem;">
                        <h3 style="margin: 0 0 0.5rem 0;">Tools + media</h3>
                        <p style="margin: 0; opacity: 0.95;">Tools, images, PDFs, Office docs, and <code>@filename</code> attachments.</p>
                    </div>
                </div>
            </div>

            <!-- Table of Contents -->
            <div style="background: var(--background-secondary); padding: 2rem; border-radius: 0.75rem; margin-bottom: 3rem;">
                <h2 style="margin: 0 0 1rem 0;">Table of Contents</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 0.75rem;">
                    <div>
                        <a href="#quick-start" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Quick Start</a>
                        <a href="#configuration" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Configuration</a>
                        <a href="#endpoints" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">API Endpoints</a>
                    </div>
                    <div>
                        <a href="#model-routing" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Model Routing</a>
                        <a href="#media" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Multimodal (Files)</a>
                        <a href="#tools" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Tools + agent_format</a>
                    </div>
                    <div>
                        <a href="#agentic-cli" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Agentic CLI Integration</a>
                        <a href="#deployment" style="display: block; padding: 0.4rem 0; color: var(--primary-color);">Deployment Notes</a>
                    </div>
                </div>
            </div>

            <div class="doc-content">
                <section id="quick-start">
                    <h2>Quick Start</h2>
                    <p>Install and run the server:</p>

                    <div class="code-block">
                        <pre><code class="language-bash">pip install "abstractcore[server]"

# Start server
python -m abstractcore.server.app

# Or with uvicorn directly
uvicorn abstractcore.server.app:app --host 0.0.0.0 --port 8000

# Health check
curl http://localhost:8000/health</code></pre>
                    </div>

                    <h3>First request (cURL)</h3>
                    <div class="code-block">
                        <pre><code class="language-bash">curl -X POST http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o-mini",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'</code></pre>
                    </div>

                    <h3>First request (Python)</h3>
                    <div class="code-block">
                        <pre><code class="language-python">from openai import OpenAI

client = OpenAI(base_url="http://localhost:8000/v1", api_key="unused")

resp = client.chat.completions.create(
    model="anthropic/claude-haiku-4-5",
    messages=[{"role": "user", "content": "Explain quantum computing in 3 bullets."}],
)
print(resp.choices[0].message.content)</code></pre>
                    </div>
                </section>

                <section id="configuration" style="margin-top: 3rem;">
                    <h2>Configuration</h2>
                    <h3>Environment variables</h3>

                    <div class="code-block">
                        <pre><code class="language-bash"># Provider API keys
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."
export OPENROUTER_API_KEY="sk-or-..."

# Local providers
export OLLAMA_BASE_URL="http://localhost:11434"          # (or legacy: OLLAMA_HOST)
export LMSTUDIO_BASE_URL="http://localhost:1234/v1"
export VLLM_BASE_URL="http://localhost:8000/v1"

# Defaults (optional)
export ABSTRACTCORE_DEFAULT_PROVIDER=openai
export ABSTRACTCORE_DEFAULT_MODEL=gpt-4o-mini

# Debug mode
export ABSTRACTCORE_DEBUG=true

# Multi-tenant hazard: allow unload_after for providers that can unload shared server state
export ABSTRACTCORE_ALLOW_UNSAFE_UNLOAD_AFTER=1</code></pre>
                    </div>

                    <h3>Startup options</h3>
                    <div class="code-block">
                        <pre><code class="language-bash">python -m abstractcore.server.app --help
python -m abstractcore.server.app --debug
python -m abstractcore.server.app --host 127.0.0.1 --port 8080

# uvicorn examples
uvicorn abstractcore.server.app:app --reload
uvicorn abstractcore.server.app:app --workers 4</code></pre>
                    </div>
                </section>

                <section id="endpoints" style="margin-top: 3rem;">
                    <h2>API Endpoints</h2>
                    <p>The server is OpenAI-compatible by default, with a few useful AbstractCore extensions.</p>

                    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 0.75rem; margin: 1rem 0;">
                        <ul style="margin: 0;">
                            <li><strong>Chat:</strong> <code>POST /v1/chat/completions</code></li>
                            <li><strong>Responses API:</strong> <code>POST /v1/responses</code></li>
                            <li><strong>Embeddings:</strong> <code>POST /v1/embeddings</code></li>
                            <li><strong>Model discovery:</strong> <code>GET /v1/models</code></li>
                            <li><strong>Provider status:</strong> <code>GET /providers</code></li>
                            <li><strong>Health:</strong> <code>GET /health</code></li>
                        </ul>
                    </div>

                    <h3>Model discovery</h3>
                    <div class="code-block">
                        <pre><code class="language-bash">curl http://localhost:8000/v1/models
curl "http://localhost:8000/v1/models?provider=ollama"
curl "http://localhost:8000/v1/models?type=text-embedding"
curl "http://localhost:8000/v1/models?provider=ollama&type=text-embedding"</code></pre>
                    </div>
                </section>

                <section id="model-routing" style="margin-top: 3rem;">
                    <h2>Model Routing</h2>
                    <p>Route to any provider/model using <code>model="provider/model-name"</code>, for example:</p>
                    <ul>
                        <li><code>openai/gpt-4o-mini</code></li>
                        <li><code>anthropic/claude-haiku-4-5</code></li>
                        <li><code>ollama/qwen3:4b-instruct</code></li>
                        <li><code>lmstudio/qwen/qwen3-4b-2507</code></li>
                    </ul>

                    <h3>Per-request extensions</h3>
                    <p>AbstractCore also supports a few optional request fields:</p>
                    <ul>
                        <li><code>api_key</code>: per-request provider key (falls back to env vars if omitted)</li>
                        <li><code>base_url</code>: override provider endpoint (include <code>/v1</code> for OpenAI-compatible servers)</li>
                        <li><code>unload_after</code>: unload model after request (restricted for some providers unless explicitly enabled)</li>
                        <li><code>thinking</code>: unified thinking/reasoning control (best-effort)</li>
                    </ul>
                </section>

                <section id="media" style="margin-top: 3rem;">
                    <h2>Multimodal Requests (Images, PDFs, Office docs)</h2>
                    <p>Two common ways to attach files:</p>

                    <h3>1) <code>@filename</code> syntax (AbstractCore extension)</h3>
                    <div class="code-block">
                        <pre><code class="language-bash">curl -X POST http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o",
    "messages": [
      {"role": "user", "content": "Summarize this report. @/path/to/report.pdf"}
    ]
  }'</code></pre>
                    </div>

                    <h3>2) OpenAI vision-style messages</h3>
                    <div style="background: var(--background-tertiary); padding: 1.25rem; border-radius: 0.75rem; margin: 1rem 0;">
                        <p style="margin: 0;">For full examples (image URLs, base64, mixed content), see <a href="media-handling-system.html">Media Handling</a> and <a href="vision-capabilities.html">Vision Capabilities</a>.</p>
                    </div>
                </section>

                <section id="tools" style="margin-top: 3rem;">
                    <h2>Tools + <code>agent_format</code></h2>
                    <p>Tool calls are supported on <code>/v1/chat/completions</code> and <code>/v1/responses</code>.</p>
                    <ul>
                        <li>Use <code>tools</code> as you would with OpenAI-compatible clients.</li>
                        <li>Set <code>agent_format</code> to request a specific tool-call syntax (useful for agentic CLIs/parsers).</li>
                    </ul>

                    <div style="background: var(--background-tertiary); padding: 1.25rem; border-radius: 0.75rem; margin: 1rem 0;">
                        <p style="margin: 0;">See <a href="tool-syntax-rewriting.html">Tool Syntax Rewriting</a> for details and supported formats.</p>
                    </div>
                </section>

                <section id="agentic-cli" style="margin-top: 3rem;">
                    <h2>Agentic CLI Integration</h2>
                    <p>Point agentic CLIs at the server by setting OpenAI-compatible environment variables.</p>

                    <h3>Codex CLI</h3>
                    <div class="code-block">
                        <pre><code class="language-bash">export OPENAI_BASE_URL="http://localhost:8000/v1"
export OPENAI_API_KEY="unused"
export ABSTRACTCORE_API_KEY="unused"

codex --model "ollama/qwen3-coder:30b" "Write a factorial function"</code></pre>
                    </div>

                    <h3>Tool-call format defaults</h3>
                    <div class="code-block">
                        <pre><code class="language-bash"># Example: prefer LLaMA3-style tool markup by default
export ABSTRACTCORE_DEFAULT_TOOL_CALL_TAGS=llama3
export ABSTRACTCORE_DEFAULT_EXECUTE_TOOLS=false</code></pre>
                    </div>
                </section>

                <section id="deployment" style="margin-top: 3rem;">
                    <h2>Deployment Notes</h2>
                    <ul>
                        <li>Use <code>uvicorn ... --workers N</code> for multiple workers in production.</li>
                        <li>Use <code>/health</code> for monitoring and readiness checks.</li>
                        <li>Be cautious with <code>unload_after</code> in multi-tenant environments.</li>
                    </ul>
                </section>

                <!-- Related Documentation -->
                <div style="margin-top: 4rem; padding: 2rem; background: var(--background-secondary); border-radius: 0.75rem;">
                    <h2 style="margin: 0 0 1.5rem 0;">Related Documentation</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <a href="tool-calling.html" style="display: block; padding: 1rem; background: var(--background); border-radius: 0.5rem; text-decoration: none; border: 1px solid var(--border-light); transition: all 0.15s ease;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Tool Calling</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">Universal tools across providers</p>
                        </a>

                        <a href="tool-syntax-rewriting.html" style="display: block; padding: 1rem; background: var(--background); border-radius: 0.5rem; text-decoration: none; border: 1px solid var(--border-light); transition: all 0.15s ease;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Tool Syntax Rewriting</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">agent_format and tool_call_tags</p>
                        </a>

                        <a href="media-handling-system.html" style="display: block; padding: 1rem; background: var(--background); border-radius: 0.5rem; text-decoration: none; border: 1px solid var(--border-light); transition: all 0.15s ease;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Media Handling</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">Files, documents, and vision fallback</p>
                        </a>

                        <a href="embeddings.html" style="display: block; padding: 1rem; background: var(--background); border-radius: 0.5rem; text-decoration: none; border: 1px solid var(--border-light); transition: all 0.15s ease;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">Embeddings</h4>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">Semantic search + RAG building blocks</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
