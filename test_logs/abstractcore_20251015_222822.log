Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Using capabilities from 'qwen3' for 'qwen3-coder:30b'
Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Using capabilities from 'qwen3' for 'qwen3-coder:30b'
{"event": "Using max_tokens 32768 from model capabilities for qwen3-coder:30b", "logger": "OllamaProvider", "level": "debug", "timestamp": "2025-10-15T20:28:22.366108Z"}
Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Using capabilities from 'qwen3' for 'qwen3-coder:30b'
{"event": "Using max_output_tokens 8192 from model capabilities for qwen3-coder:30b", "logger": "OllamaProvider", "level": "debug", "timestamp": "2025-10-15T20:28:22.366179Z"}
load_ssl_context verify=True cert=None trust_env=True http2=False
load_verify_locations cafile='/opt/anaconda3/lib/python3.12/site-packages/certifi/cacert.pem'
Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Detected architecture 'qwen3_moe' for model 'qwen3-coder:30b' (pattern: 'qwen3-coder:30b')
Using capabilities from 'qwen3' for 'qwen3-coder:30b'
Initialized tool handler for qwen3-coder:30b: architecture=qwen3_moe, native=False, prompted=True
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "prompt_length": 40, "max_retries": 3, "event": "Starting structured output generation", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:22.371097Z"}
{"provider": "OllamaProvider", "event": "Using prompted structured output with retry", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:22.371143Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:22.371502Z"}
connect_tcp.started host='localhost' port=11434 local_address=None timeout=None socket_options=None
connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x35004dc10>
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:23 GMT'), (b'Content-Length', b'318')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-7, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "json_length": 17, "attempt": 2, "event": "JSON parsing failed, attempting self-fix", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.504892Z"}
JSON self-fix: Extracted JSON from surrounding text
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-7, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "attempt": 2, "event": "Self-fix failed", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.504978Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "StrictNumber", "attempt_duration_ms": 1133.5010528564453, "error_type": "ValidationError", "error_message": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-7, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "response_length": 17, "validation_success": false, "event": "Validation attempt failed", "logger": "abstractcore.structured.handler", "level": "warning", "timestamp": "2025-10-15T20:28:23.505033Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 3, "retry_reason": "validation_error", "event": "Preparing retry with validation feedback", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:23.505082Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 3, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.505125Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:23 GMT'), (b'Content-Length', b'324')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "json_length": 17, "attempt": 3, "event": "JSON parsing failed, attempting self-fix", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.765626Z"}
JSON self-fix: Extracted JSON from surrounding text
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "attempt": 3, "event": "Self-fix failed", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.765877Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 3, "response_model": "StrictNumber", "attempt_duration_ms": 260.80894470214844, "error_type": "ValidationError", "error_message": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "response_length": 21, "validation_success": false, "event": "Validation attempt failed", "logger": "abstractcore.structured.handler", "level": "warning", "timestamp": "2025-10-15T20:28:23.765985Z"}
{"provider": "OllamaProvider", "attempt": 3, "max_attempts": 3, "retry_reason": "validation_error", "event": "Preparing retry with validation feedback", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:23.766272Z"}
{"provider": "OllamaProvider", "attempt": 3, "max_attempts": 3, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:23.766417Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:24 GMT'), (b'Content-Length', b'318')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "json_length": 17, "attempt": 4, "event": "JSON parsing failed, attempting self-fix", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.008389Z"}
JSON self-fix: Extracted JSON from surrounding text
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "attempt": 4, "event": "Self-fix failed", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.008756Z"}
{"provider": "OllamaProvider", "attempt": 3, "max_attempts": 3, "response_model": "StrictNumber", "attempt_duration_ms": 242.44928359985352, "error_type": "ValidationError", "error_message": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "response_length": 17, "validation_success": false, "event": "Validation attempt failed", "logger": "abstractcore.structured.handler", "level": "warning", "timestamp": "2025-10-15T20:28:24.008934Z"}
{"provider": "OllamaProvider", "total_attempts": 3, "max_attempts": 3, "response_model": "StrictNumber", "final_error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "validation_success": false, "event": "All validation attempts exhausted", "logger": "abstractcore.structured.handler", "level": "error", "timestamp": "2025-10-15T20:28:24.009130Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "duration_ms": 1638.2169723510742, "error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-5, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "error_type": "ValidationError", "success": false, "event": "Structured output generation failed", "logger": "abstractcore.structured.handler", "level": "error", "timestamp": "2025-10-15T20:28:24.009366Z"}
{"session_id": "complex_validation_test", "event": "Session started", "logger": "session", "level": "info", "timestamp": "2025-10-15T20:28:24.009910Z"}
{"session_id": "complex_validation_test", "event": "Starting complex validation test", "logger": "session", "level": "info", "timestamp": "2025-10-15T20:28:24.010010Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "ComplexData", "prompt_length": 43, "max_retries": 3, "event": "Starting structured output generation", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:24.010171Z"}
{"provider": "OllamaProvider", "event": "Using prompted structured output with retry", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.010255Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "ComplexData", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.011128Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:24 GMT'), (b'Content-Length', b'405')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "ComplexData", "attempt_duration_ms": 641.7160034179688, "response_length": 88, "validation_success": true, "event": "Validation attempt succeeded", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:24.652858Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "ComplexData", "strategy": "prompted", "duration_ms": 642.8232192993164, "success": true, "event": "Structured output generation completed", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:24.652984Z"}
{"session_id": "complex_validation_test", "result": "items=['item1', 'item2', 'item3'] count=3 average=0.0", "event": "Unexpected success", "logger": "session", "level": "info", "timestamp": "2025-10-15T20:28:24.653071Z"}
{"session_id": "complex_validation_test", "duration_seconds": 0.6432299613952637, "event": "Session ended", "logger": "session", "level": "info", "timestamp": "2025-10-15T20:28:24.653132Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "prompt_length": 31, "max_retries": 2, "event": "Starting structured output generation", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:24.653381Z"}
{"provider": "OllamaProvider", "event": "Using prompted structured output with retry", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.653437Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 2, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.653788Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:24 GMT'), (b'Content-Length', b'321')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "json_length": 19, "attempt": 2, "event": "JSON parsing failed, attempting self-fix", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.968320Z"}
JSON self-fix: Extracted JSON from surrounding text
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "attempt": 2, "event": "Self-fix failed", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.968647Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 2, "response_model": "StrictNumber", "attempt_duration_ms": 314.9678707122803, "error_type": "ValidationError", "error_message": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "response_length": 19, "validation_success": false, "event": "Validation attempt failed", "logger": "abstractcore.structured.handler", "level": "warning", "timestamp": "2025-10-15T20:28:24.968826Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 2, "retry_reason": "validation_error", "event": "Preparing retry with validation feedback", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:24.969023Z"}
{"attempt": 1, "error_type": "ValidationError", "event": "Preparing custom retry prompt", "logger": "tests.test_retry_observability", "level": "info", "timestamp": "2025-10-15T20:28:24.969225Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 2, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:24.969389Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:25 GMT'), (b'Content-Length', b'321')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "json_length": 19, "attempt": 3, "event": "JSON parsing failed, attempting self-fix", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:25.225699Z"}
JSON self-fix: Extracted JSON from surrounding text
{"error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "attempt": 3, "event": "Self-fix failed", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:25.225781Z"}
{"provider": "OllamaProvider", "attempt": 2, "max_attempts": 2, "response_model": "StrictNumber", "attempt_duration_ms": 256.43014907836914, "error_type": "ValidationError", "error_message": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "response_length": 19, "validation_success": false, "event": "Validation attempt failed", "logger": "abstractcore.structured.handler", "level": "warning", "timestamp": "2025-10-15T20:28:25.225832Z"}
{"provider": "OllamaProvider", "total_attempts": 2, "max_attempts": 2, "response_model": "StrictNumber", "final_error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "validation_success": false, "event": "All validation attempts exhausted", "logger": "abstractcore.structured.handler", "level": "error", "timestamp": "2025-10-15T20:28:25.225871Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "duration_ms": 572.5367069244385, "error": "1 validation error for StrictNumber\nvalue\n  Value error, Value must be positive integer [type=value_error, input_value=-100, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/value_error", "error_type": "ValidationError", "success": false, "event": "Structured output generation failed", "logger": "abstractcore.structured.handler", "level": "error", "timestamp": "2025-10-15T20:28:25.225908Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "prompt_length": 44, "max_retries": 3, "event": "Starting structured output generation", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:25.226016Z"}
{"provider": "OllamaProvider", "event": "Using prompted structured output with retry", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:25.226054Z"}
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "StrictNumber", "event": "Starting validation attempt", "logger": "abstractcore.structured.handler", "level": "debug", "timestamp": "2025-10-15T20:28:25.226227Z"}
send_request_headers.started request=<Request [b'POST']>
send_request_headers.complete
send_request_body.started request=<Request [b'POST']>
send_request_body.complete
receive_response_headers.started request=<Request [b'POST']>
receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 15 Oct 2025 20:28:25 GMT'), (b'Content-Length', b'317')])
HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
receive_response_body.started request=<Request [b'POST']>
receive_response_body.complete
response_closed.started
response_closed.complete
{"provider": "OllamaProvider", "attempt": 1, "max_attempts": 3, "response_model": "StrictNumber", "attempt_duration_ms": 306.7889213562012, "response_length": 17, "validation_success": true, "event": "Validation attempt succeeded", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:25.533064Z"}
{"provider": "OllamaProvider", "model": "qwen3-coder:30b", "response_model": "StrictNumber", "strategy": "prompted", "duration_ms": 307.29174613952637, "success": true, "event": "Structured output generation completed", "logger": "abstractcore.structured.handler", "level": "info", "timestamp": "2025-10-15T20:28:25.533324Z"}
